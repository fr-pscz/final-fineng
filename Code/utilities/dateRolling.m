function D = dateRolling(D,CONV)
%DATEROLLING Automatic date rolling according to TARGET2 trading days.
%   INPUTS:
%       D:    array of dates to convert
%       CONV: business day convention (follow, modifiedfollow,
%             previous, modifiedprevious)
%
%   OUTPUTS:
%       D:    input array with rolled dates

%% Checks
% dateRolling doesn't work after 31dec2099 and before 1jan2000
if max(D) > 767010 || min(D) < 730486
    error("ERROR: Input dates D exceed holiday range.")
end

%% Holidays
% 600 holidays between 2000-2099
targetH = [730486;730597;730600;730607;730845;730846;730852;730954;730957;730972;731210;731211;731217;731304;731307;731337;731575;731576;731582;731689;731692;731702;731940;731941;731947;732046;732049;732068;732306;732307;732313;732396;732399;732433;732671;732672;732678;732781;732784;732798;733036;733037;733043;733138;733141;733163;733401;733402;733408;733488;733491;733529;733767;733768;733774;733873;733876;733894;734132;734133;734139;734230;734233;734259;734497;734498;734504;734615;734618;734624;734862;734863;734869;734965;734968;734990;735228;735229;735235;735322;735325;735355;735593;735594;735600;735707;735710;735720;735958;735959;735965;736057;736060;736085;736323;736324;736330;736414;736417;736451;736689;736690;736696;736799;736802;736816;737054;737055;737061;737149;737152;737181;737419;737420;737426;737534;737537;737546;737784;737785;737791;737891;737894;737912;738150;738151;738157;738248;738251;738277;738515;738516;738522;738626;738629;738642;738880;738881;738887;738983;738986;739007;739245;739246;739252;739340;739343;739373;739611;739612;739618;739725;739728;739738;739976;739977;739983;740075;740078;740103;740341;740342;740348;740432;740435;740468;740706;740707;740713;740817;740820;740834;741072;741073;741079;741167;741170;741199;741437;741438;741444;741552;741555;741564;741802;741803;741809;741909;741912;741929;742167;742168;742174;742259;742262;742295;742533;742534;742540;742644;742647;742660;742898;742899;742905;743001;743004;743025;743263;743264;743270;743351;743354;743390;743628;743629;743635;743736;743739;743756;743994;743995;744001;744093;744096;744121;744359;744360;744366;744478;744481;744486;744724;744725;744731;744828;744831;744851;745089;745090;745096;745185;745188;745217;745455;745456;745462;745570;745573;745582;745820;745821;745827;745920;745923;745947;746185;746186;746192;746277;746280;746312;746550;746551;746557;746662;746665;746678;746916;746917;746923;747019;747022;747043;747281;747282;747288;747369;747372;747408;747646;747647;747653;747754;747757;747773;748011;748012;748018;748111;748114;748139;748377;748378;748384;748489;748492;748504;748742;748743;748749;748846;748849;748869;749107;749108;749114;749203;749206;749234;749472;749473;749479;749588;749591;749600;749838;749839;749845;749938;749941;749965;750203;750204;750210;750295;750298;750330;750568;750569;750575;750680;750683;750695;750933;750934;750940;751030;751033;751061;751299;751300;751306;751415;751418;751426;751664;751665;751671;751772;751775;751791;752029;752030;752036;752122;752125;752156;752394;752395;752401;752507;752510;752522;752760;752761;752767;752864;752867;752887;753125;753126;753132;753214;753217;753252;753490;753491;753497;753599;753602;753617;753855;753856;753862;753956;753959;753983;754221;754222;754228;754313;754316;754348;754586;754587;754593;754691;754694;754713;754951;754952;754958;755048;755051;755078;755316;755317;755323;755433;755436;755444;755682;755683;755689;755790;755793;755809;756047;756048;756054;756140;756143;756174;756412;756413;756419;756525;756528;756539;756777;756778;756784;756882;756885;756905;757143;757144;757150;757232;757235;757270;757508;757509;757515;757617;757620;757635;757873;757874;757880;757974;757977;758000;758238;758239;758245;758352;758355;758366;758604;758605;758611;758709;758712;758731;758969;758970;758976;759066;759069;759096;759334;759335;759341;759451;759454;759461;759699;759700;759706;759801;759804;759827;760065;760066;760072;760158;760161;760192;760430;760431;760437;760543;760546;760557;760795;760796;760802;760893;760896;760922;761160;761161;761167;761250;761253;761288;761526;761527;761533;761635;761638;761653;761891;761892;761898;761985;761988;762018;762256;762257;762263;762370;762373;762383;762621;762622;762628;762727;762730;762749;762987;762988;762994;763084;763087;763114;763352;763353;763359;763462;763465;763479;763717;763718;763724;763819;763822;763844;764082;764083;764089;764176;764179;764210;764448;764449;764455;764554;764557;764575;764813;764814;764820;764911;764914;764940;765178;765179;765185;765296;765299;765305;765543;765544;765550;765653;765656;765671;765909;765910;765916;766003;766006;766036;766274;766275;766281;766388;766391;766401;766639;766640;766646;766745;766748;766766;767004;767005];

%% Rolling
% only non-trading days are modified
D(~isbusday(D, targetH)) = ...
    busdate(D(~isbusday(D, targetH)),...
            {CONV},...
            targetH);
end
